<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    .container,.btn-container{
        width: 900px;
        margin: 50px auto;
    }
    .item-container{
        display: -webkit-box;
    }
    .item{
        -webkit-box-flex: 1;
        font-size: 25px;
        color: white;
        background-color: #bbb;
        height: 50px;
        font-weight: bold;
        line-height: 50px;
        text-align: center;
        border-radius: 10px;
        margin: 20px 0;
        text-decoration: none;
        display: block;
    }
    .btn-container{
        margin-top: 50px;
        display: -webkit-box;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        height: 50px;
    }
    .btn-container .btn{
        font-size: 30px;
        color: white;
        background-color: lightseagreen;
        height: 50px;
        width: 300px;
        line-height: 50px;
        text-align: center;
        border-radius: 10px;
        margin: 0 20px;
        cursor: pointer;
    }
    .tag-container{
        max-width: 800px;
        margin: 50px auto 0;
    }
    .tag-container .tag{
        height: 35px;
        line-height: 35px;
        font-size: 30px;
        font-weight: bold;
        background-color: lightskyblue;
        padding: 0 30px;
        color: white;
        float: left;
        margin-top: 15px;
        margin-right: 40px;
        border-radius: 10px;
        cursor: pointer;
    }
    .search-container{
        margin-top: 30px;
        display: -webkit-box;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        height: 50px;
    }
    .tag-container:after{
        content: '';
        clear: both;
        display: block;
        height:0;
        visibility:hidden;
    }
    .search-container .input{
        margin-right:50px;
    }
    .input{
        display: block;
        width: 300px;
        height: 50px;
        line-height: 50px;
        border: none;
        padding: 0;
        background-color: #eee;
        font-size: 20px;
        text-indent: 20px;
    }
    .search-container .search-btn{
        height: 50px;
        line-height: 50px;
        width: 100px;
        font-size: 25px;
        text-align: center;
        color: white;
        border-radius: 10px;
        background-color: lightseagreen;
        cursor: pointer;
    }
    .del-btn{
        height: 50px;
        line-height: 50px;
        width: 100px;
        font-size: 25px;
        text-align: center;
        color: white;
        border-radius: 10px;
        background-color: lightcoral;
        cursor: pointer;
        margin: 20px 0 20px 50px;
        display: none;
    }
    .show .del-btn{
        display: block;
    }
    .header{
        margin-top: 30px;
        display: -webkit-box;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        height: 50px;
    }
    .header .page-text{
        color: lightcoral;
        font-size: 40px;
        line-height: 50px;
        margin: 0 50px;
    }
    .header .tag-text{
        height: 50px;
        line-height: 50px;
        background-color: lightskyblue;
        padding: 0 30px;
        color: white;
        font-size: 40px;
        border-radius: 10px;
        margin: 0 50px;
        display: none;
    }
    .header .search-text{
        color: #999;
        font-size: 40px;
        line-height: 50px;
        margin: 0 50px;
    }
    .user{
        position: absolute;
        right: 0;
        display: -webkit-box;
    }
    .action{
        position: absolute;
        left: 0;
        display: -webkit-box;
    }
    .login-btn,.register-btn{
        height: 50px;
        line-height: 50px;
        width: 100px;
        font-size: 25px;
        text-align: center;
        color: white;
        border-radius: 10px;
        background-color: lightseagreen;
        cursor: pointer;
        margin: 0 20px;
    }
    .pop-btn{
        height: 50px;
        line-height: 50px;
        width: 100px;
        font-size: 25px;
        text-align: center;
        color: white;
        border-radius: 10px;
        background-color: lightseagreen;
        cursor: pointer;
        margin: 50px 0;
    }
    .pop{
        width: 100%;
        height: 100%;
        position: fixed;
        left: 0;
        top: 0;
        display: none;
    }
    .shadow{
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1;
        position: fixed;
        left: 0;
        top: 0;
    }
    .pop-container{
        position: relative;
        z-index: 999;
        width: 800px;
        margin: 200px auto 0;
        background: white;
        display: -webkit-box;
        -webkit-box-align: center;
        -webkit-box-pack: center;
        -webkit-box-orient: vertical;
    }
    .pop-container label{
        color: #999;
        font-size: 30px;
        line-height: 50px;
    }
    .pop-title{
        color: lightseagreen;
        font-size: 30px;
        line-height: 50px;
        margin: 30px;
    }
    .name{
        color: #999;
        font-size: 30px;
        line-height: 50px;
        margin: 0 30px;
    }
</style>
<body>
    <div class="header">
        <div class="page-text"></div>
        <div class="tag-text"></div>
        <div class="search-text"></div>
        <div class="action">
            <div class="login-btn">登录</div>
            <div class="register-btn">注册</div>
        </div>
        <div class="user">
            <div class="name"></div>
        </div>
    </div>
    <div class="search-container">
        <input type="text" class="input" id="keywords">
        <div class="search-btn">搜索</div>
    </div>
    <div class="container">
    </div>
    <div class="btn-container">
        <div class="prev btn">上一页</div>
        <div class="next btn">下一页</div>
    </div>
    <div class="tag-container">
    </div>
    <div class="pop">
        <div class="shadow"></div>
        <div class="pop-container">
            <div class="pop-title">注册</div>
            <div>
                <label for="">用户名:</label> <input type="text" class="input" id="username">
            </div>
            <div>
                <label for="">密码:</label> <input type="password" class="input" id="password">
            </div>
            <div class="pop-btn">确定</div>
        </div>
    </div>
</body>
<script id="tpl" type="text/html">

    <%for(var i = 0; i < list.length; i++) {%>
    <div class="item-container">
        <a class="item" href="./detail.html?id=<%:=list[i]._id%>"><%:=list[i].title%></a>
        <div class="del-btn" data-id="<%:=list[i]._id%>">删除</div>
    </div>
    <%}%>
</script>
<script src="./assets/jquery.js"></script>
<script src="./assets/template.js"></script>
<script>
    window.onload = function(){
        window.template();
        window.popMode = 'login';
        window.username = localStorage.getItem('username');
        if(username === 'cmy5001'){
            $('.container').addClass('show');
        }
        window.token = localStorage.getItem('token');
        $('.name').html(window.username);
        function getSearch(){
            var search = location.search.split('?')[1];
            var obj = {};
            if(search){
                var searchArray = search.split('&');
                searchArray.forEach(function(item,index){
                    var opt = item.split('=');
                    obj[opt[0]] = opt[1];
                })
            }
            return obj;
        }
        var searchObj = getSearch();

        var page = searchObj.page || 1;
        var tag = searchObj.tag || '';
        var title = searchObj.title || '';

        if(page){
            $('.page-text').text(page);
        }
        if(tag){
            $('.tag-text').text(decodeURIComponent(tag)).show();
        }
        if(title){
            $('.search-text').text(decodeURIComponent(title));
        }

        getList();
        function getList(){

            $.get('/showImages',{page:page,tag:tag,title:title,token:token},function(data){
                var tpl = document.getElementById('tpl').innerHTML;
                var html = template(tpl, {list: data});
                $('.container').html(html);
            })
        }

        $(document).on('click','.del-btn',function(){
            console.log($(this).attr('data-id'));
            var id = $(this).attr('data-id');
            if(!id) return
            if(!window.confirm('确定要删除吗?')) return
            $.get('/delete',{id: id, token: token},function(data){
                console.log(data);
                if(data.msg){
                    alert(data.msg)
                }else{
                    location.reload();
                }
            })
        });

        $('.shadow').click(function(){
            $('.pop').hide();
        });

        $('.register-btn').click(function(){
            $('.pop').show();
            $('.pop-title').html('注册');
            window.popMode = 'register';
        });

        $('.login-btn').click(function(){
            $('.pop').show();
            $('.pop-title').html('登录');
            window.popMode = 'login';
        });

        $('.pop-btn').click(function(){
            var username = $('#username').val();
            var password = $('#password').val();
            if(!username || !password) return;
            $.get('/'+window.popMode,{username: username, password: password},function(data){
                console.log(data);
                if(data.msg){
                    alert(data.msg)
                }
                localStorage.setItem('token', data.token || '');
                localStorage.setItem('username', data.username || '');
                location.reload();
            })
        });

        $('.prev').click(function(){
            if(page>1){
                page--;
                var url = location.origin+location.pathname+'?page='+page;
                if(tag){
                    url += '&tag='+tag;
                }
                if(title){
                    url += '&title='+title;
                }
                location.href = url;
            }
        });
        $('.next').click(function(){
            page++;
            var url = location.origin+location.pathname+'?page='+page;
            if(tag){
                url += '&tag='+tag;
            }
            if(title){
                url += '&title='+title;
            }
            location.href = url;
        });
//        var tags = ['无圣光','极品萝莉','推女郎','CHOKmoson', '柚木', '土肥圆矮挫穷', '小鸟酱', 'TuiGirl', 'XIUREN', 'Graphis', 'PR社', '露出自拍', '疯狂的爱丽丝', 'VIP', 'SK丝库', '大尺度', '爱丝AISS', '唐兴', 'wanimal', '秀人网', '极品美模', '极品嫩妹', '福利姬', '闫盼盼', '布丁酱', '尤蜜荟', '弱气乙女', '完具少女', '刘钰儿', '丝袜美腿极欲调教', '尤果网', '木奈奈', 'YouMi', '魅妍社', '摄影师', '嗲囡囡', '私拍', '网络红人', 'Tpimage', 'Mistar', '若兮', 'PLAYBOY', 'LegBaby', 'Ugirls', '我是女王', '小果酱', '蜜桃社', '私人玩物', '宋-KiKi', '悦爷妖精', '撸管必备', '夏小秋秋秋', 'Egg-尤妮丝', 'MASKED QUEEN', '王语纯', '假面女皇', '松果儿', '微博红人', '大屌萌妹', 'OWAKADO'];
//        var html = '';
//        tags.forEach(function(item,index){
//            html += '<div class="tag">'+item+'</div>';
//        });
//        $('.tag-container').append(html);
        $('.tag').click(function(){
            location.href = '/index.html?tag='+$(this).text();
        })
        $('.search-btn').click(function(){
            location.href = '/index.html?title='+$('#keywords').val();
        })
    }
</script>
</html>